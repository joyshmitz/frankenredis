{
  "suite": "core_strings",
  "cases": [
    {
      "name": "ping",
      "now_ms": 0,
      "argv": ["PING"],
      "expect": { "kind": "simple", "value": "PONG" }
    },
    {
      "name": "set_foo",
      "now_ms": 10,
      "argv": ["SET", "foo", "bar"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "get_foo",
      "now_ms": 10,
      "argv": ["GET", "foo"],
      "expect": { "kind": "bulk", "value": "bar" }
    },
    {
      "name": "incr_counter_1",
      "now_ms": 20,
      "argv": ["INCR", "counter"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "incr_counter_2",
      "now_ms": 20,
      "argv": ["INCR", "counter"],
      "expect": { "kind": "integer", "value": 2 }
    },
    {
      "name": "expire_foo",
      "now_ms": 1000,
      "argv": ["EXPIRE", "foo", "1"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pttl_foo_not_expired",
      "now_ms": 1000,
      "argv": ["PTTL", "foo"],
      "expect": { "kind": "integer", "value": 1000 }
    },
    {
      "name": "foo_expires",
      "now_ms": 2001,
      "argv": ["GET", "foo"],
      "expect": { "kind": "bulk", "value": null }
    },
    {
      "name": "pttl_foo_missing",
      "now_ms": 2001,
      "argv": ["PTTL", "foo"],
      "expect": { "kind": "integer", "value": -2 }
    },
    {
      "name": "set_px",
      "now_ms": 3000,
      "argv": ["SET", "ephemeral", "v", "PX", "20"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "pttl_ephemeral",
      "now_ms": 3000,
      "argv": ["PTTL", "ephemeral"],
      "expect": { "kind": "integer", "value": 20 }
    },
    {
      "name": "ephemeral_expired",
      "now_ms": 3021,
      "argv": ["GET", "ephemeral"],
      "expect": { "kind": "bulk", "value": null }
    },
    {
      "name": "set_expire_options_key",
      "now_ms": 3100,
      "argv": ["SET", "optkey", "v"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "expire_nx_initial",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "10", "NX"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "expire_nx_reject_existing_ttl",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "20", "NX"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "expire_xx_accept_existing_ttl",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "20", "XX"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "expire_gt_reject_smaller_deadline",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "15", "GT"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "expire_gt_accept_larger_deadline",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "25", "GT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "expire_lt_reject_larger_deadline",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "30", "LT"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "expire_lt_accept_smaller_deadline",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "5", "LT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "set_persistent_expire_options_key",
      "now_ms": 3200,
      "argv": ["SET", "persistent", "v"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "expire_xx_rejects_no_ttl",
      "now_ms": 3200,
      "argv": ["EXPIRE", "persistent", "5", "XX"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "expire_gt_rejects_no_ttl",
      "now_ms": 3200,
      "argv": ["EXPIRE", "persistent", "5", "GT"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "expire_lt_accepts_no_ttl",
      "now_ms": 3200,
      "argv": ["EXPIRE", "persistent", "5", "LT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "set_abskey",
      "now_ms": 3300,
      "argv": ["SET", "abskey", "v"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "pexpire_abskey",
      "now_ms": 3300,
      "argv": ["PEXPIRE", "abskey", "250"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pttl_abskey",
      "now_ms": 3300,
      "argv": ["PTTL", "abskey"],
      "expect": { "kind": "integer", "value": 250 }
    },
    {
      "name": "pexpiretime_abskey",
      "now_ms": 3300,
      "argv": ["PEXPIRETIME", "abskey"],
      "expect": { "kind": "integer", "value": 3550 }
    },
    {
      "name": "expiretime_abskey",
      "now_ms": 3300,
      "argv": ["EXPIRETIME", "abskey"],
      "expect": { "kind": "integer", "value": 4 }
    },
    {
      "name": "abskey_expired",
      "now_ms": 3551,
      "argv": ["GET", "abskey"],
      "expect": { "kind": "bulk", "value": null }
    },
    {
      "name": "set_whenkey",
      "now_ms": 3600,
      "argv": ["SET", "whenkey", "v"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "expireat_whenkey",
      "now_ms": 3600,
      "argv": ["EXPIREAT", "whenkey", "6"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pttl_whenkey_after_expireat",
      "now_ms": 3600,
      "argv": ["PTTL", "whenkey"],
      "expect": { "kind": "integer", "value": 2400 }
    },
    {
      "name": "pexpireat_whenkey",
      "now_ms": 3600,
      "argv": ["PEXPIREAT", "whenkey", "7000"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pttl_whenkey_after_pexpireat",
      "now_ms": 3600,
      "argv": ["PTTL", "whenkey"],
      "expect": { "kind": "integer", "value": 3400 }
    },
    {
      "name": "expiretime_whenkey",
      "now_ms": 3600,
      "argv": ["EXPIRETIME", "whenkey"],
      "expect": { "kind": "integer", "value": 7 }
    },
    {
      "name": "set_poptkey",
      "now_ms": 3700,
      "argv": ["SET", "poptkey", "v"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "pexpire_nx_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "1000", "NX"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pexpire_gt_accept_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "1500", "GT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pexpire_gt_reject_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "1200", "GT"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "pexpire_xx_gt_accept_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "2000", "XX", "GT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pexpire_xx_lt_accept_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "1000", "XX", "LT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pexpire_xx_lt_reject_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "1500", "XX", "LT"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "pexpire_lt_accept_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "500", "LT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "unknown_command",
      "now_ms": 4000,
      "argv": ["NOPE"],
      "expect": { "kind": "error", "value": "ERR unknown command 'NOPE'" }
    },
    {
      "name": "wrong_arity",
      "now_ms": 4001,
      "argv": ["GET"],
      "expect": { "kind": "error", "value": "ERR wrong number of arguments for 'GET' command" }
    }
  ]
}
